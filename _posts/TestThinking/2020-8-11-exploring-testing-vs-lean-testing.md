---
layout: post
title: 探索性测试 VS 精益测试
date: 2020-8-11
categories: blog
header-img: "../img/header/Home7.jpg"
tags: [测试锦囊]
description: 探索性测试 VS 精益测试

---

2020年7月底，客户方的十几位产品人来ThoughtWorks进行经验交流，公司准备了好几个议题，我有幸负责《ThoughtWorks测试方法论与实践的交流》，在方法论部分，我着重分享了ThoughtWorks一直秉承着的“探索性测试”和“精益测试”两大核心的测试理念；在实践部分，我分享了在敏捷和DevOps开发模式下该如何测试。

这次的分享出乎意料地成功，原计划40分钟搞定，却由于过程中引发了太多有趣的思考和讨论，会议最终持续了1.5小时，大家都还意犹未尽。

不料，前天，客户又邀请我们于8月12日再做一次线上交流，欲将上次的内容分享给公司更多的同事。趁着今天有空，我不妨就这两大核心的测试理念写一篇文章，来进一步打磨和精进其中的细节，希望能给明天的分享带来更多不一样的体验。

---

## 探索性测试

我于2019年12月22日发表了一篇名为《[“探索性测试”在敏捷项目中的运用](https://mp.weixin.qq.com/s?__biz=MzIwMjY0NzgwNQ==&mid=2247484403&idx=1&sn=51bf7b30c49d112883e8711b4f162ce5&chksm=96da3261a1adbb77c23aaf6b8ec6ecc9017c4078c5c383362e7d39fb1365ff7bcea82a93288e&token=856926690&lang=zh_CN#rd)》的公众号推文。后来，这篇文章有幸被“清华大学出版社”、“水木IT社区”、“DevOps”、及“ThoughtWorks洞见”公众号申请转载。可当我再次细读文章时，却发现部分例证其实可以更精准，无奈公众号推文无法修改，我只好借这篇文章重新阐述。不过本文只从部分视角入手，更多内容，仍建议阅读[上一篇文章](https://mp.weixin.qq.com/s?__biz=MzIwMjY0NzgwNQ==&mid=2247484403&idx=1&sn=51bf7b30c49d112883e8711b4f162ce5&chksm=96da3261a1adbb77c23aaf6b8ec6ecc9017c4078c5c383362e7d39fb1365ff7bcea82a93288e&token=856926690&lang=zh_CN#rd)。

### 如何理解探索性测试

​举个例子，为了7月底的这次经验交流会，ThoughtWorks计划专门为参会人员定制一款马克杯。供应商设计并研发好了样品，提供给我们验收。

​<center>
    <img width="50%" src="{{site.baseurl }}/img/exploring&lean-testing/img-001.jpg" align="center">
</center>

传统测试会如何验收呢？

首先，阅读产品需求规格说明，理解需求。

> **材质** ：陶瓷
> 
> **容量** ：250ml
>  
> **外观** ：(外)绿色釉面、(里)米色釉面、米色Logo、标注容量 
> 
> **功能**：可盛白开水、茶、咖啡、牛奶等一般热饮

然后，根据需求规格设计测试用例。我们运用“等价类”和“边界值”测试方法设计了三组测试用例，然后用仪器检测材质；用眼睛观察UI；用实际装水、咖啡、茶、牛奶的过程来验证功能。最后，逐一执行测试用例，我们发现，有一条UI的用例测试不通过。

| Test Suite          | Test No.  | Test Cases                                   |Test Result             |
|:------------- |:-------:| :----------------------------:|:--------------:|
| 材质测试            | 1             | 材质为陶瓷                                    | Passed                 |
| UI测试               | 1             | 外观为绿色釉面+米色Logo+容量标记 | Passed                 |
|                         | 2            | 里面为米色釉面                               | Failed                 |
| 功能测试            | 1             | 能盛白开水250ml                          | Passed                 |
|                         | 2            | 能盛咖啡249ml                             | Passed                 |
|                         | 3            | 能盛茶251ml                                | Passed                 |
|                         | 4            | 能盛牛奶并加热                             | Passed                 |


那么，如何运用探索性测试验收呢？

和传统测试一样，首先需要根据需求设计测试、然后逐一执行。然而，探索性测试到这里并没有结束。

* 在测试执行过程中，我们有了新的发现，进而引发出一些思考：

	* 现象：盛完茶水，杯子里好多茶渍
	* 思考：能不能刷干净？

* 与此同时，我们忽然想到一些特殊的场景：

	* 上班的时候，我常常要端着杯子辗转于各个会议室，会一开就是一个多小时。  250ml容量够不够？没有盖子，水会不会容易撒出来？

这些过程中想到的点都还没有得到验证，因此需要将其添加到测试用例中。**与传统测试不同的是，设计用例的时候，我们并不一定清楚期待结果，而是要根据实际发生的结果去判断能否接受**。比如，盛完茶水，杯子里好多茶渍，可是稍微一刷便焕然一新，那么就是可接受的结果。而如果，我使劲了浑身解数，茶渍依然纹丝不动，那这个马克杯只能当做一次性的了，着实可惜、不可接受。而对于第二个特殊场景，250ml容量的确不够，没有盖子，水也的确会容易洒出来。可它们真的是问题吗？针对用户的特殊需求，换个容量大一点儿的、带盖子的杯子，或许才是解决问题的最佳选择。

相比之下，传统测试的过程是线性发生的，“先设计、再测试”，很多公司甚至要求在设计用例的时候就达到100%覆盖。而探索性测试是环状的，**主张学习**，强调**同时展开测试设计、执行、并从结果中获得反馈，从而持续优化测试**。这是**一种主张即兴发挥、快速试验、快速学习和动态调整的测试思维方式**，而不是某一种具体的测试技术。
​<center>
    <img width="100%" src="{{site.baseurl }}/img/exploring&lean-testing/img-002.jpg" align="center">
</center>
​
传统测试帮助我们交付满足要求的产品；而**探索性测试则是为了交付更高质量的产品**。
​
### 运用“漫游地图模型”梳理测试策略
​
《探索性测试实践之路》一书提到一种“漫游地图模型”，它将测试比拟为游客在城市中漫游，将其分为商业区、历史区、旅游区、破旧区、娱乐区、及旅馆区。

*  商业区：人们在商业区完成一天的工作
*  历史区：很多城市都有历史古迹，很多游客往往为了追随历史古迹而来
*  旅游区：旅游区大部分只有游客才去，而当地人会尽量避开这些拥堵的地方
*  破旧区：破旧区是一个城市最不受欢迎的地方，可能存在违法乱纪的现象
*  娱乐区：游客经历了景点和名胜古迹的游览之后，需要在娱乐区休闲和放松一下，从而使假期变的张弛有度
*  旅馆区：游客经过了繁忙的旅程之后，需要在旅馆区休息，恢复体力


“漫游地图模型”帮助测试人员规划和分解被测产品、制定测试策略。

*  ​首先，在白纸上画出商业区、历史区、旅游区、破旧区、娱乐区、及旅馆区，代表软件系统的6各区域
*  接着，整理出软件的功能，将每个功能写在一张卡片上
*  ​最后，将功能卡片贴到对应的区域
​​<center>
    <img width="100%" src="{{site.baseurl }}/img/exploring&lean-testing/img-003.jpg" align="center"></center>

​
产品分解之后，究竟该如何测试呢？

* **商业区**：用户花钱买软件就是因为软件的特性使得他们的业务得以完成。商业区测试类型着重于测试软件的主要特性，因此，需要频繁地进行回归测试，以持续保证这些主要特性的可用性。由于具有很高的重复性，“商业区”的测试将是自动化测试关注的重点
* **旅游区**：对于软件，有些特性对新用户更有吸引力。这一点也涉及到部分用户权限的测试
* **历史区**：软件也一样具有前版本的历史遗留代码，这个区域的测试目的就是测试遗留代码和遗留缺陷。这一点在遗留系统改造项目中体现的尤为明显。”新开发特性不影响原有特性”将成为测试重点
* **旅馆区**：当软件“休息”时，它实际上还是非常忙碌的。旅馆区模型关注的是一些辅助功能，比如软件后台运行等
* **娱乐区**：对于软件，比如一个购物网站，商业区是搜索商品、加入购物车、生成订单、付款等，而其娱乐区就是指漂亮美观的UI、友好的用户界面等。这就需要关注到用户体验和兼容性测试
* **破旧区**：不同于旅游，软件的破旧区可能存在严重的缺陷、安全及性能问题。这部分可能是软件的重灾区，需要关注异常测试、性能测试和安全测试

### 运用探索性测试指导自动化测试
​
自动化测试，是指将人为驱动的测试行为转化成机器、工具或者代码执行的一种测试方法。

我们通常将需求明确的、业务稳定的、需要重复回归测试的部分用自动化测试来实现；而将需求不明确、变动频繁的、无需重复测试的、或者需要日志等特殊形式验证结果的部分，配合探索性测试思路，通过手工测试来完成。

但自动化测试与手工测试并不是相互割裂的，而存在一个相互转化的过程。​仍然以上面定制的马克杯为例：
​
​​​<center>
    <img width="100%" src="{{site.baseurl }}/img/exploring&lean-testing/img-004.jpg" align="center"></center>
​
* 首先，需求规格中明确提到的点往往是软件的核心功能，需求明确、业务稳定、也需要通过反复测试来保证这些功能的可用性，因此是自动化测试的首选
* 其次，如上面讲到的，在测试过程中，我们有了新的发现，或者想到一些特殊场景。在最开始，我们并不清楚这些新学习到的点的实际结果会是怎么样的，因此需要手工测试，测试的步骤和期待结果都需要探索
* 接着，在手工执行的过程中，我们最终证实了一些用例。比如，盛完茶的杯子，确定是能被刷干净的。那么，我们就可以直接将这个已经确定的点添加到自动化测试脚本中
* 最后，有一些思考被证明的确是问题，但我们并不需要去解决它，也无需再去关注，直接舍弃就好了

分享完探索性测试，在座的产品人问道：“看起来，运行探索性测试，的确有助于发现很多需求中未能明确提到的质量问题。可是，如此发散，成本该如何控制呢？有没有最佳使用场景？测试覆盖又该如何计算？”

---

## 精益测试

“精益测试”是ThoughtWorks 资深 QA 咨询师林冰玉提出的概念，她曾专门写过一篇博客《[精益测试](https://mp.weixin.qq.com/s/8UqbCZNmXttZhVvtXrFoiQ)》，也讲过直播课程[《ThoughWorks敏捷测试第三讲：精益测试》](https://app.ma.scrmtech.com/meetings-api/sapIndex/SapSourceData?pf_uid=7019_1254&sid=16238&source=2&pf_type=3&channel_id=779&channel_name=insights&tag_id=7066157a5b2dd0c0&appid=wx4bd00f95dd7c7ca1)。想要了解原汁原味的内容，建议回看录播。

而我，不仅是知识的搬运工，更希望阐述一些自己对于“精益测试”的理解。

### 如何理解精益测试

“精益测试”的理念是将“精益生产”与“测试”相结合。

根据维基百科对于“精益生产”的描述：精益生产主要来源于丰田生产方式(TPS)的生产哲学，也称为丰田主义 (Toyotism)，一直到 1990 年间才称为精益生产。精益生产的目标是控制库存量，**减少生产过程中的浪费**，其核心是“Just in time”，旨在需要的时候，按需要的量，生产所需的产品，也就是用最少工作，创造价值。

测试要做到精益，就是要减少测试中的浪费，不能一味的追求测试覆盖率，大而全的测试覆盖本身就是一种浪费。因此，精益测试并不是一种具体的测试方法，它是一种思维，其价值主要是为了帮助团队制定合适的测试策略，让测试更有效。

对于“精益测试”的定义，我们应该这样理解：

>对能体现业务价值的点，做到有效的测试覆盖，减少浪费，从而以尽量少的成本交付高质量的软件。
    
### 精益测试的核心原则

​测试如何才能做到精益，如何才能避免浪费呢？这就不得不提到精益测试核心原则，我们将其总结为TAT：适时（Time）、适量（Amount）、精准（Target）。
​​​​<center>
    <img width="90%" src="{{site.baseurl }}/img/exploring&lean-testing/img-005.jpg" align="center"></center>

* **适时（Time）**：敏捷测试要求测试全程参与，让测试活动发生在敏捷软件开发生命周期的每个环节，而让每种类型的测试发生在它最该发生的时刻。比如，开发人员在开始实现一个故事卡之前，召集BA和QA一起做Kick Off，以帮助各个角色对需求达成一致的理解，避免在开始开发前就对需求产生误解。而在完成一张需求卡的开发之后、提交测试之前，一起做Desk check，按照故事卡上的验收标准逐条演示，这样就能避免问题要等到QA人员正式开始测试之后才被发现。
* **适量（Amount）**：不再盲目的追求100%测试覆盖，需要权衡利弊，把时间花在真正有价值的事情上，这也是精益的体现。我见过一些公司，将测试覆盖率作为QA人员的KPI，要求达到100%覆盖。最终花费了太多精力去测试一些并不那么重要的模块、或者花了更多精力在一些并不重要的自动化测试脚本的维护上。这必然造成极大的浪费。
* **精准（Target）**：精准测试通常是指根据代码改动所影响到的范围去针对性的测试。比如，当开发修复一个Bug之后，我们并不需要将整个系统重新测试一遍。正确的做法是，精准地分析出Bug本身、及Bug的影响范围，然后针对性地测试。其中，Bug本身的回归测试就是High level的测试，而影响范围则是Medium的测试。

### 精益测试的指导框架

林冰玉提到了两个测试指导框架：测试四象限和测试分层。在这里，我想重点阐述我对测试分层的理解。

关于测试分层的概念，大家可能更为熟悉的是测试金字塔 ( https://martinfowler.com/bliki/TestPyramid.html )，测试金字塔呈现的是不同种类测试比例的多少，底层单元测试较多，越往上层测试比例越少，呈现为金字塔结构。
​​​​<center>
    <img width="80%" src="{{site.baseurl }}/img/exploring&lean-testing/img-006.jpg" align="center"></center>

* 单元测试：旨在测试程序中的最小可测单元，隔离性很高、无需其他依赖、执行速度较快，因此建议在每次提交完代码并且通过编译之后、部署测试环境之前完成”单元测试“。
* API测试：主要关注在系统架构的业务逻辑层，我们通过工具或代码方式去调用特定的API，给定输入、获取输出，验证响应结果。API测试不仅要关注正常场景，更要关注异常场景。API测试执行效率比较高，可以根据项目环境稳定情况，设置每次部署环境之后启动测试，也可以每天在固定的时间执行测试。
* UI测试：UI测试关注用户界面及用户体验。通过代码或工具模拟用户通过键盘输入或鼠标操作等行为来与系统交互。由于UI测试执行效率相对较低，建议在每天环境相对稳定的时间段执行测试。
* E2E测试：端到端测试应该覆盖那些业务价值最高的路径，并不关注异常场景。要做到这一点，需要在设计测试时，从最终用户的角度来考虑，通过用户画像和User Journey来确定测试场景。E2E测试是回归测试的好帮手，可能会在版本发布前的一段时间频繁执行。
* 冒烟测试：冒烟测试是一种针对软件版本包的快速验证策略，如果冒烟测试没有通过，则不必进行更深入的测试。因此，我们可以从E2E测试中抽取两到三条最核心的场景设置为冒烟测试，在每次环境部署之后启动测试，从而快速验证本次版本的可用性。
    
    
其实，随着技术架构、系统特点、质量要求、团队技能水平等因素的不同，每种测试的比例也不尽相同，不一定都是金字塔结构，如下图所示的蜂巢结构或者甜筒冰淇淋结构都有可能。
不管比例如何，每层测试有着自己的特点。越往底层的测试越接近代码，编写成本更低、执行速度更快、定位问题也更准确，但是离业务较远，不能很好的体现业务价值；越往上层的测试越接近业务，更能反应业务价值，但有着不够稳定、执行速度慢、实现成本较高、问题定位难的不足。因此，需要权衡利弊，根据项目具体情况，真实的目标来确定每层测试的比例。    
--- 

## 总结

精益测试的思想主要是帮助团队制定合适的测试策略，并不是一种具体的测试方法。精益测试的精髓是将测试做到适时、适量和精准，就是让测试做到恰到好处以减少浪费。

测试策略受众多因素的影响，需要做到目标驱动，并且根据具体情况随着时间推移不断的演进。测试四象限和测试分层都只是指导框架，不是必须遵守的规范，可以作为测试策略制定的参考模型，具体项目的策略还需根据项目特定情况进行调整。